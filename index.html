<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>WELCOME RAVI VO</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0f1724; --card:#0b1220; --muted:#9aa7b2; --accent:#20c997; --radius:14px; }
    * { box-sizing: border-box; }
    body { margin:0; font-family:Arial, Helvetica, sans-serif; background:var(--bg); color:#e6eef6; height:100vh; }
    /* LOGIN */
    #loginPage { display:flex; justify-content:center; align-items:center; height:100vh; }
    .login-box { background:#111a2a; padding:30px; border-radius:var(--radius); width:340px; text-align:center; }
    .login-box h2 { margin-bottom:20px; }
    .login-row { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    .login-box input[type="password"], .login-box input[type="text"] {
      flex:1;
      padding:10px;
      border-radius:8px;
      border:1px solid #1d2941;
      background:#0b1425;
      color:#e6eef6;
      outline:none;
    }
    .toggle-btn { padding:10px 12px; border-radius:8px; border:none; background:#2a3552; color:#fff; cursor:pointer; }
    .toggle-btn:hover { background:#3a4a72; }
    .login-box .login-submit { width:100%; padding:10px; margin-top:8px; border:none; border-radius:8px; background:var(--accent); cursor:pointer; font-weight:bold; }
    .login-box .login-submit:hover { background:#18a97d; }
    .error { color:#ffb3b3; font-size:14px; margin-top:10px; min-height:18px; }

    /* PORTFOLIO */
    #portfolio { display:none; height:100vh; }
    body.portfolio-mode { display:flex; }
    .sidebar { width:260px; background:#111a2a; padding:12px; display:flex; flex-direction:column; gap:10px; }
    .logo { display:flex; align-items:center; gap:10px; }
    .mark { background:var(--accent); color:#000; font-weight:bold; padding:8px 12px; border-radius:10px; }
    .title { margin:0; font-size:16px; letter-spacing:.5px; }
    .search-box input { width:100%; padding:10px; border-radius:8px; border:1px solid #1d2941; background:#0b1425; color:#e6eef6; outline:none; }
    .menu { display:flex; flex-direction:column; gap:6px; overflow:auto; }
    .menu a { display:block; padding:10px 12px; border-radius:8px; text-decoration:none; color:var(--muted); cursor:pointer; }
    .menu a:hover, .menu a.active { background:var(--accent); color:#000; }
    .content { flex:1; overflow-y:auto; padding:20px; }
    section { display:none; background:var(--card); padding:20px; border-radius:var(--radius); animation: fade .18s ease-in; }
    section.active { display:block; }
    @keyframes fade { from {opacity:0; transform:translateY(4px)} to {opacity:1; transform:none} }
    .profile-pic { height:220px; background:#222; border-radius:12px; display:flex; justify-content:center; align-items:center; margin-bottom:10px; overflow:hidden; }
    .profile-pic img { width:100%; height:100%; object-fit:cover; display:block; }
    .btn { background:#333; color:#fff; border:none; border-radius:10px; padding:10px 14px; margin:6px 6px 6px 0; cursor:pointer; font-size:14px; }
    .btn:hover { background:var(--accent); color:#000; }
    .btn.sm { padding:6px 10px; font-size:12px; border-radius:8px; }
    .preview { background:#0e1525; border:1px dashed #3b4a66; border-radius:12px; padding:12px; margin:12px 0; display:flex; flex-wrap:wrap; gap:12px; min-height:100px; align-items:flex-start; }
    .file-card { background:#1a2236; padding:10px; border-radius:10px; width:140px; display:flex; flex-direction:column; gap:8px; }
    .thumb { background:#0c1220; border-radius:8px; display:flex; align-items:center; justify-content:center; height:90px; overflow:hidden; }
    .thumb img { max-width:100%; max-height:100%; display:block; }
    .pdf-pill { font-size:12px; color:#d1e3ff; }
    .file-name { font-size:12px; color:var(--muted); text-align:center; word-break:break-word; min-height:30px; }
    .actions { display:flex; gap:6px; justify-content:center; flex-wrap:wrap; }
    footer { margin-top:20px; text-align:center; color:var(--muted); }
    .viewer { position:fixed; inset:0; background:rgba(0,0,0,.75); display:none; align-items:center; justify-content:center; padding:24px; z-index:9999; }
    .viewer.show { display:flex; }
    .viewer-box { background:#0b1220; border:1px solid #22304d; border-radius:14px; width:min(1100px,95vw); height:min(85vh,900px); padding:12px; display:flex; flex-direction:column; gap:10px; }
    .viewer-bar { display:flex; justify-content:space-between; align-items:center; }
    .viewer-title { font-size:14px; color:#cfe0f5; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .viewer-close { background:#2a3552; color:#fff; border:none; border-radius:8px; padding:6px 10px; cursor:pointer; }
    .viewer-close:hover { background:#4b5e8d; }
    .viewer-content { flex:1; background:#0e1525; border:1px solid #203056; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    .viewer-content img { max-width:100%; max-height:100%; display:block; }
    .viewer-content iframe { width:100%; height:100%; border:0; background:#fff; }
    @media (max-width: 880px) {
      body.portfolio-mode { flex-direction:column; height:auto; }
      .sidebar { width:100%; position:sticky; top:0; z-index:10; }
      .login-box { width:92%; }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="loginPage">
    <div class="login-box">
      <h2>Login</h2>
      <div class="login-row">
        <input type="password" id="passwordInput" placeholder="Enter password" />
        <button id="togglePwd" class="toggle-btn" type="button" aria-label="Show password">üëÅ</button>
      </div>
      <button id="loginBtn" class="login-submit">Login</button>
      <div class="error" id="errorMsg"></div>
    </div>
  </div>

  <!-- PORTFOLIO -->
  <div id="portfolio">
    <aside class="sidebar">
      <div class="logo">
        <div class="mark">VO</div>
        <h1 class="title">WELCOME RAVI VO</h1>
      </div>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search section..." />
      </div>
      <nav class="menu" id="menu"></nav>
    </aside>

    <main class="content" id="content"></main>
  </div>

  <!-- Viewer -->
  <div class="viewer" id="viewer">
    <div class="viewer-box">
      <div class="viewer-bar">
        <div class="viewer-title" id="viewerTitle">Preview</div>
        <button class="viewer-close" id="viewerClose">Close ‚úï</button>
      </div>
      <div class="viewer-content" id="viewerContent"></div>
    </div>
  </div>

<script>
/* ---------- CONFIG ---------- */
const LOGIN_PASSWORD = "Jeevanraviygr@3"; // required password
const sectionsList = [
  "About", "PAN Card", "Vehicle", "ABHA Health", "Canteen", "Driving License", "Dependent Card", "Police Card",
  "Adhar Card", "Voter ID", "Birth Certificate", "RC Card", "Department Card", "Insurance", "Working Certificate",
  "NOC", "IT Returns", "Marks Cards", "Bank Passbooks", "Deeds", "Department Forms", "Office Letters",
  "Paanis (Layout Sketch)", "Health Tips", "Bills", "Warranty Cards", "Photos", "Activities", "Others",
  "Gas Passbook", "Ration Card", "Pention"
];

/* ---------- LOGIN ---------- */
const loginPage = document.getElementById('loginPage');
const portfolio  = document.getElementById('portfolio');
const passwordInput = document.getElementById('passwordInput');
const togglePwdBtn = document.getElementById('togglePwd');
const loginBtn = document.getElementById('loginBtn');
const errorMsg = document.getElementById('errorMsg');

togglePwdBtn.addEventListener('click', () => {
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    togglePwdBtn.textContent = 'üôà';
    togglePwdBtn.setAttribute('aria-label','Hide password');
  } else {
    passwordInput.type = 'password';
    togglePwdBtn.textContent = 'üëÅ';
    togglePwdBtn.setAttribute('aria-label','Show password');
  }
});

function showError(msg) {
  errorMsg.textContent = msg;
  setTimeout(()=>{ errorMsg.textContent = ''; }, 4000);
}

loginBtn.addEventListener('click', () => {
  const val = (passwordInput.value || '').trim();
  if (val.length < 8) { showError("Password must be at least 8 characters"); return; }
  if (val === LOGIN_PASSWORD) {
    loginPage.style.display = 'none';
    portfolio.style.display = 'flex';
    document.body.classList.add('portfolio-mode');
    // Clear input
    passwordInput.value = '';
    togglePwdBtn.textContent = 'üëÅ';
    passwordInput.type = 'password';
  } else {
    showError("Incorrect password!");
  }
});
passwordInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') loginBtn.click(); });

/* ---------- DYNAMIC UI BUILDING ---------- */
const menu = document.getElementById('menu');
const content = document.getElementById('content');

// Helper to make safe key from name
function makeKey(name){
  return name.toLowerCase().replace(/\s+/g,'').replace(/[()]/g,'').replace(/[^a-z0-9\-]/g,'');
}

// Build menu + sections
sectionsList.forEach((name, idx) => {
  const id = makeKey(name);
  // Menu link
  const a = document.createElement('a');
  a.href = '#';
  a.dataset.section = id;
  a.textContent = name;
  if (idx === 0) a.classList.add('active');
  menu.appendChild(a);

  // Section
  const sec = document.createElement('section');
  sec.id = id;
  if (idx === 0) sec.classList.add('active');
  sec.innerHTML = `
    <h2>${name}</h2>
    ${name === 'About' ? `
      <div class="profile-pic">
        <div id="placeholder">Upload profile image</div>
        <img id="profileImage" style="display:none;" alt="Profile preview">
      </div>
      <label class="btn" for="profileUpload">Upload Profile</label>
      <input id="profileUpload" type="file" accept="image/*" style="display:none;">
      <button id="downloadJPG" class="btn" disabled>‚¨á JPG</button>
      <button id="downloadPDF" class="btn" disabled>‚¨á PDF</button>
    ` : `
      <label class="btn" for="input-${id}">Upload Files</label>
      <input id="input-${id}" type="file" multiple accept="image/*,application/pdf" style="display:none;">
      <div class="preview" id="preview-${id}"><div>No files uploaded</div></div>
    `}
  `;
  content.appendChild(sec);
});

/* ---------- NAVIGATION & SEARCH ---------- */
function activateSection(targetId) {
  // activate menu
  document.querySelectorAll('.menu a').forEach(a => a.classList.toggle('active', a.dataset.section === targetId));
  // activate content
  document.querySelectorAll('main section').forEach(s => s.classList.toggle('active', s.id === targetId));
}
menu.addEventListener('click', (e) => {
  const a = e.target.closest('a');
  if (!a) return;
  e.preventDefault();
  activateSection(a.dataset.section);
});

document.getElementById('searchInput').addEventListener('input', function(){
  const q = this.value.toLowerCase();
  document.querySelectorAll('.menu a').forEach(l=>{
    l.style.display = l.textContent.toLowerCase().includes(q) ? 'block' : 'none';
  });
});

/* ---------- STORAGE / RENDERING ---------- */
function readFileAsDataURL(file){
  return new Promise((resolve,reject) => {
    const fr = new FileReader();
    fr.onload = ()=> resolve(fr.result);
    fr.onerror = reject;
    fr.readAsDataURL(file);
  });
}
// file item structure: { id, name, type, data }
const store = {}; // map key => array of items

function saveStoreForKey(key){
  try {
    localStorage.setItem('files-'+key, JSON.stringify(store[key]));
  } catch (err) {
    console.error('Failed to save to localStorage', err);
    alert('Saving failed: localStorage quota may be exceeded.');
  }
}

function renderAllForKey(key){
  const preview = document.getElementById('preview-'+key);
  if (!preview) return;
  preview.innerHTML = '';
  const arr = store[key] || [];
  if (!arr.length) {
    preview.innerHTML = '<div>No files uploaded</div>';
    return;
  }
  arr.forEach(item => renderCard(preview, item, key));
}

function renderCard(container, item, key){
  // container is the preview element
  const card = document.createElement('div');
  card.className = 'file-card';

  const thumb = document.createElement('div');
  thumb.className = 'thumb';
  if (item.type && item.type.startsWith('image/')) {
    const img = document.createElement('img');
    img.src = item.data;
    thumb.appendChild(img);
  } else {
    const span = document.createElement('span');
    span.className = 'pdf-pill';
    span.textContent = 'PDF';
    thumb.appendChild(span);
  }

  const nameDiv = document.createElement('div');
  nameDiv.className = 'file-name';
  nameDiv.textContent = item.name;

  const actions = document.createElement('div');
  actions.className = 'actions';

  const viewBtn = document.createElement('button');
  viewBtn.className = 'btn sm';
  viewBtn.textContent = 'View';
  viewBtn.addEventListener('click', () => openViewer(item));

  const dlBtn = document.createElement('button');
  dlBtn.className = 'btn sm';
  dlBtn.textContent = 'Download';
  dlBtn.addEventListener('click', () => {
    const a = document.createElement('a');
    a.href = item.data;
    a.download = item.name;
    a.click();
  });

  const delBtn = document.createElement('button');
  delBtn.className = 'btn sm';
  delBtn.textContent = 'Delete';
  delBtn.addEventListener('click', () => {
    // confirm deletion
    if (!confirm('Delete this file?')) return;
    removeFileById(key, item.id);
  });

  actions.appendChild(viewBtn);
  actions.appendChild(dlBtn);
  actions.appendChild(delBtn);

  card.appendChild(thumb);
  card.appendChild(nameDiv);
  card.appendChild(actions);

  container.appendChild(card);
}

function removeFileById(key, id){
  const arr = store[key] || [];
  const idx = arr.findIndex(x => x.id === id);
  if (idx === -1) return;
  arr.splice(idx, 1);
  saveStoreForKey(key);
  renderAllForKey(key);
}

/* ---------- INITIALIZE STORAGE & SETUP INPUTS ---------- */
sectionsList.forEach(name => {
  const key = makeKey(name);
  store[key] = [];
  // load saved
  const saved = localStorage.getItem('files-'+key);
  if (saved) {
    try { store[key] = JSON.parse(saved) || []; } catch(e){ store[key]=[]; }
  }
  // If About: special profile handlers are elsewhere
  if (key === makeKey('About')) return;

  // Setup input listener
  const input = document.getElementById('input-'+key);
  const preview = document.getElementById('preview-'+key);
  if (!input || !preview) return;

  // Render any saved items initially
  if (store[key].length > 0) preview.innerHTML = '';
  renderAllForKey(key);

  input.addEventListener('change', async (e) => {
    const files = Array.from(e.target.files || []);
    if (!files.length) return;
    if (preview.textContent.trim() === 'No files uploaded') preview.innerHTML = '';
    for (const f of files) {
      const data = await readFileAsDataURL(f);
      const item = { id: Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,9), name: f.name, type: f.type || 'application/octet-stream', data };
      store[key].push(item);
    }
    saveStoreForKey(key);
    renderAllForKey(key);
    input.value = '';
  });
});

/* ---------- PROFILE (About) ---------- */
const profileKey = makeKey('About');
const profileUpload = document.getElementById('profileUpload');
const profileImage  = document.getElementById('profileImage');
const placeholder   = document.getElementById('placeholder');
const downloadJPG   = document.getElementById('downloadJPG');
const downloadPDF   = document.getElementById('downloadPDF');

(function restoreProfile(){
  const stored = localStorage.getItem('profileData');
  if (stored){
    try {
      const { name, data } = JSON.parse(stored);
      if (data){
        profileImage.src = data;
        profileImage.style.display = 'block';
        placeholder.style.display = 'none';
        downloadJPG.disabled = false;
        downloadPDF.disabled = false;
      }
    } catch {}
  }
})();

profileUpload && profileUpload.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const data = await readFileAsDataURL(file);
  // save as profileData
  try { localStorage.setItem('profileData', JSON.stringify({ name: file.name, data })); } catch(e){ alert('Saving profile failed: storage limit?'); }
  profileImage.src = data;
  profileImage.style.display = 'block';
  placeholder.style.display = 'none';
  downloadJPG.disabled = false;
  downloadPDF.disabled = false;
  profileUpload.value = '';
});

downloadJPG.addEventListener('click', () => {
  const stored = localStorage.getItem('profileData');
  if (!stored) return;
  try {
    const { name, data } = JSON.parse(stored);
    const a = document.createElement('a');
    a.href = data;
    a.download = name || 'profile.jpg';
    a.click();
  } catch {}
});

downloadPDF.addEventListener('click', async () => {
  const stored = localStorage.getItem('profileData');
  if (!stored) return;
  try {
    const { data } = JSON.parse(stored);
    const { jsPDF } = window.jspdf;
    const img = new Image();
    img.src = data;
    img.onload = function(){
      const pdf = new jsPDF({ orientation: img.width > img.height ? 'l' : 'p', unit:'px', format:[img.width, img.height] });
      pdf.addImage(img, 'JPEG', 0, 0, img.width, img.height);
      pdf.save('profile.pdf');
    };
  } catch (e) { console.error(e); }
});

/* ---------- VIEWER ---------- */
const viewer = document.getElementById('viewer');
const viewerContent = document.getElementById('viewerContent');
const viewerTitle = document.getElementById('viewerTitle');
const viewerClose = document.getElementById('viewerClose');

viewerClose.addEventListener('click', () => viewer.classList.remove('show'));
viewer.addEventListener('click', (ev) => { if (ev.target === viewer) viewer.classList.remove('show'); });
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') viewer.classList.remove('show'); });

function openViewer(item){
  viewerContent.innerHTML = '';
  viewerTitle.textContent = item.name || 'Preview';
  if (item.type && item.type.startsWith('image/')) {
    const img = document.createElement('img');
    img.src = item.data;
    viewerContent.appendChild(img);
  } else {
    const iframe = document.createElement('iframe');
    iframe.src = item.data;
    viewerContent.appendChild(iframe);
  }
  viewer.classList.add('show');
}
</script>
</body>
</html>
